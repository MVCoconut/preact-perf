{"version":3,"file":"preact-router.js","sources":["../../../../../../src/util.js","../../../../../../src/index.js"],"sourcesContent":["\nconst EMPTY = {};\n\nexport function exec(url, route, opts=EMPTY) {\n\tlet reg = /(?:\\?([^#]*))?(#.*)?$/,\n\t\tc = url.match(reg),\n\t\tmatches = {},\n\t\tret;\n\tif (c && c[1]) {\n\t\tlet p = c[1].split('&');\n\t\tfor (let i=0; i<p.length; i++) {\n\t\t\tlet r = p[i].split('=');\n\t\t\tmatches[decodeURIComponent(r[0])] = decodeURIComponent(r.slice(1).join('='));\n\t\t}\n\t}\n\turl = segmentize(url.replace(reg, ''));\n\troute = segmentize(route || '');\n\tlet max = Math.max(url.length, route.length);\n\tfor (let i=0; i<max; i++) {\n\t\tif (route[i] && route[i].charAt(0)===':') {\n\t\t\tlet param = route[i].replace(/(^\\:|[+*?]+$)/g, ''),\n\t\t\t\tflags = (route[i].match(/[+*?]+$/) || EMPTY)[0] || '',\n\t\t\t\tplus = ~flags.indexOf('+'),\n\t\t\t\tstar = ~flags.indexOf('*'),\n\t\t\t\tval = url[i] || '';\n\t\t\tif (!val && !star && (flags.indexOf('?')<0 || plus)) {\n\t\t\t\tret = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmatches[param] = decodeURIComponent(val);\n\t\t\tif (plus || star) {\n\t\t\t\tmatches[param] = url.slice(i).map(decodeURIComponent).join('/');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse if (route[i]!==url[i]) {\n\t\t\tret = false;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (opts.default!==true && ret===false) return false;\n\treturn matches;\n}\n\nexport function pathRankSort(a, b) {\n\tlet aAttr = a.attributes || EMPTY,\n\t\tbAttr = b.attributes || EMPTY;\n\tif (aAttr.default) return 1;\n\tif (bAttr.default) return -1;\n\tlet diff = rank(aAttr.path) - rank(bAttr.path);\n\treturn diff || (aAttr.path.length - bAttr.path.length);\n}\n\nexport function segmentize(url) {\n\treturn strip(url).split('/');\n}\n\nexport function rank(url) {\n\treturn (strip(url).match(/\\/+/g) || '').length;\n}\n\nexport function strip(url) {\n\treturn url.replace(/(^\\/+|\\/+$)/g, '');\n}\n","import { h, Component } from 'preact';\nimport { exec, pathRankSort } from './util';\n\nconst ROUTERS = [];\n\nconst EMPTY = {};\n\n\nfunction route(url, replace=false) {\n\tif (typeof url!=='string' && url.url) {\n\t\treplace = url.replace;\n\t\turl = url.url;\n\t}\n\tif (typeof history!=='undefined' && history.pushState) {\n\t\tif (replace===true) {\n\t\t\thistory.replaceState(null, null, url);\n\t\t}\n\t\telse {\n\t\t\thistory.pushState(null, null, url);\n\t\t}\n\t}\n\treturn routeTo(url);\n}\n\n\nfunction routeTo(url) {\n\tlet didRoute = false;\n\tROUTERS.forEach( router => {\n\t\tif (router.routeTo(url)===true) {\n\t\t\tdidRoute = true;\n\t\t}\n\t});\n\treturn didRoute;\n}\n\n\nfunction getCurrentUrl() {\n\tlet url = typeof location!=='undefined' ? location : EMPTY;\n\treturn `${url.pathname || ''}${url.search || ''}`;\n}\n\n\nfunction routeFromLink(node) {\n\t// only valid elements\n\tif (!node || !node.getAttribute) return;\n\n\tlet href = node.getAttribute('href'),\n\t\ttarget = node.getAttribute('target');\n\n\t// ignore links with targets and non-path URLs\n\tif (!href || !href.match(/^\\//g) || (target && !target.match(/^_?self$/i))) return;\n\n\t// attempt to route, if no match simply cede control to browser\n\treturn route(href);\n}\n\n\nfunction handleLinkClick(e) {\n\trouteFromLink(e.currentTarget || e.target || this);\n\treturn prevent(e);\n}\n\n\nfunction prevent(e) {\n\tif (e) {\n\t\tif (e.stopImmediatePropagation) e.stopImmediatePropagation();\n\t\tif (e.stopPropagation) e.stopPropagation();\n\t\te.preventDefault();\n\t}\n\treturn false;\n}\n\n\nfunction delegateLinkHandler(e) {\n\t// ignore events the browser takes care of already:\n\tif (e.ctrlKey || e.metaKey || e.altKey || e.shiftKey) return;\n\n\tlet t = e.target;\n\tdo {\n\t\tif (String(t.nodeName).toUpperCase()==='A' && t.getAttribute('href')) {\n\t\t\t// if link is handled by the router, prevent browser defaults\n\t\t\tif (routeFromLink(t)) {\n\t\t\t\treturn prevent(e);\n\t\t\t}\n\t\t}\n\t} while ((t=t.parentNode));\n}\n\n\nif (typeof addEventListener==='function') {\n\taddEventListener('popstate', () => routeTo(getCurrentUrl()));\n\taddEventListener('click', delegateLinkHandler);\n}\n\n\nconst Link = ({ children, ...props }) => (\n\t<a {...props} onClick={handleLinkClick}>{ children }</a>\n);\n\n\nclass Router extends Component {\n\tstate = {\n\t\turl: this.props.url || getCurrentUrl()\n\t};\n\n\tshouldComponentUpdate(props) {\n\t\tif (props.static!==true) return true;\n\t\treturn props.url!==this.props.url || props.onChange!==this.props.onChange;\n\t}\n\n\trouteTo(url) {\n\t\tthis._didRoute = false;\n\t\tthis.setState({ url });\n\t\tthis.forceUpdate();\n\t\treturn this._didRoute;\n\t}\n\n\tcomponentWillMount() {\n\t\tROUTERS.push(this);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tROUTERS.splice(ROUTERS.indexOf(this), 1);\n\t}\n\n\trender({ children, onChange }, { url }) {\n\t\tlet active = children.slice().sort(pathRankSort).filter( ({ attributes }) => {\n\t\t\tlet path = attributes.path,\n\t\t\t\tmatches = exec(url, path, attributes);\n\t\t\tif (matches) {\n\t\t\t\tattributes.url = url;\n\t\t\t\tattributes.matches = matches;\n\t\t\t\t// copy matches onto props\n\t\t\t\tfor (let i in matches) {\n\t\t\t\t\tif (matches.hasOwnProperty(i)) {\n\t\t\t\t\t\tattributes[i] = matches[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\tlet current = active[0] || null;\n\t\tthis._didRoute = !!current;\n\n\t\tlet previous = this.previousUrl;\n\t\tif (url!==previous) {\n\t\t\tthis.previousUrl = url;\n\t\t\tif (typeof onChange==='function') {\n\t\t\t\tonChange({\n\t\t\t\t\trouter: this,\n\t\t\t\t\turl,\n\t\t\t\t\tprevious,\n\t\t\t\t\tactive,\n\t\t\t\t\tcurrent\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn current;\n\t}\n}\n\n\nconst Route = ({ component:RoutedComponent, url, matches }) => (\n\t<RoutedComponent {...{url, matches}} />\n);\n\n\nRouter.route = route;\nRouter.Router = Router;\nRouter.Route = Route;\nRouter.Link = Link;\n\nexport { route, Router, Route, Link };\nexport default Router;\n"],"names":["EMPTY","h","Component"],"mappings":"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"}